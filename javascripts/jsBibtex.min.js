function array(){return Array.prototype.slice.call(arguments)}function array_key_exists(a,b){return!b||b.constructor!==Array&&b.constructor!==Object?!1:a in b}function array_keys(a,b,c){var d=new Array,c=!!c,e=!0,f=0;for(key in a)e=!0,void 0!=b&&(c&&a[key]!==b?e=!1:a[key]!=b&&(e=!1)),e&&(d[f]=key,f++);return d}function in_array(a,b,c){var e,d=!1,c=!!c;for(e in b)if(c&&b[e]===a||!c&&b[e]==a){d=!0;break}return d}function sizeof(a,b){return count(a,b)}function count(a,b){var c,d=0;"COUNT_RECURSIVE"==b&&(b=1),1!=b&&(b=0);for(c in a)d++,1!=b||!a[c]||a[c].constructor!==Array&&a[c].constructor!==Object||(d+=count(a[c],1));return d}function explode(a,b,c){var d={0:""};if(arguments.length<2||"undefined"==typeof arguments[0]||"undefined"==typeof arguments[1])return null;if(""===a||a===!1||null===a)return!1;if("function"==typeof a||"object"==typeof a||"function"==typeof b||"object"==typeof b)return d;if(a===!0&&(a="1"),c){var e=b.toString().split(a.toString()),f=e.splice(0,c-1),g=e.join(a.toString());return f.push(g),f}return b.toString().split(a.toString())}function implode(a,b){return b instanceof Array?b.join(a):b}function join(a,b){return implode(a,b)}function split(a,b){return explode(a,b)}function str_replace(a,b,c){for(var d=a,e=b,f=c,g=is_array(e),h=is_array(f),d=[].concat(d),e=[].concat(e),i=(f=[].concat(f)).length;j=0,i--;)for(;f[i]=f[i].split(d[j]).join(g?e[j]||"":e[0]),++j in d;);return h?f:f[0]}function strlen(a){return(""+a).length}function strpos(a,b,c){var d=a.indexOf(b,c);return d>=0?d:!1}function strrpos(a,b,c){var d=a.lastIndexOf(b,c);return d>=0?d:!1}function strtolower(a){return a.toLowerCase()}function strtoupper(a){return a.toUpperCase()}function substr(a,b,c){return 0>b&&(b+=a.length),void 0==c?c=a.length:c+=0>c?a.length:b,b>c&&(c=b),a.substring(b,c)}function trim(a,b){var c;c=b?b.replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^\:])/g,"$1"):" \n\r	\f\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000";for(var d=0;d<a.length;d++)if(-1===c.indexOf(a.charAt(d))){a=a.substring(d);break}for(d=a.length-1;d>=0;d--)if(-1===c.indexOf(a.charAt(d))){a=a.substring(0,d+1);break}return-1===c.indexOf(a.charAt(0))?a:""}function wordwrap(a,b,c,d){var h,i,j,k,l,e=b,f=c,g=d;if(1>e)return a;for(h=-1,j=(l=a.split("\n")).length;++h<j;l[h]+=k)for(k=l[h],l[h]="";k.length>e;l[h]+=k.slice(0,i)+((k=k.slice(i)).length?f:""))i=2==g||(i=k.slice(0,e+1).match(/\S*(\s)?$/))[1]?e:i.input.length-i[0].length||1==g&&e||i.input.length+(i=k.slice(e).match(/^\S*/)).input.length;return l.join("\n")}function is_string(a){return"string"==typeof a}function ord(a){return a.charCodeAt(0)}function array_unique(a){var b,c,d,e=a;for(c=e.length;c;)for(b=--c;b>0;)if(e[c]===e[--b]){for(d=b;--b&&e[c]===e[b];);c-=e.splice(b+1,d-b).length}return e}function print_r(a,b){var c="",d=" ",e=4,f=function(a,b,c,d){b>0&&b++;var e=g(c*b,d),h=g(c*(b+1),d),i="";if(a instanceof Array||a instanceof Object){i+="Array\n"+e+"(\n";for(var j in a)i+=a[j]instanceof Array||a[j]instanceof Object?h+"["+j+"] => "+f(a[j],b+1,c,d):h+"["+j+"] => "+a[j]+"\n";i+=e+")\n"}else i=a.toString();return i},g=function(a,b){for(var c="",d=0;a>d;d++)c+=b;return c};return c=f(a,0,e,d),b!==!0?(document.write("<pre>"+c+"</pre>"),!0):c}function is_array(a){return a instanceof Array}function BibTex(a){"undefined"==typeof a&&(a={}),this.data,this.content,this._delimiters,this.warnings,this._options,this.rtfstring,this.htmlstring,this.allowedEntryTypes,this.authorstring,this._delimiters={'"':'"',"{":"}"},this.data=[],this.content="",this.warnings=[],this._options={stripDelimiter:!0,validate:!0,unwrap:!1,wordWrapWidth:!1,wordWrapBreak:"\n",wordWrapCut:0,removeCurlyBraces:!1,extractAuthors:!0};for(option in a)test=this.setOption(option,a[option]),this.isError(test);this.rtfstring='AUTHORS, "{\b TITLE}", {i JOURNAL}, YEAR',this.htmlstring='AUTHORS, "<strong>TITLE</strong>", <em>JOURNAL</em>, YEAR<br />',this.allowedEntryTypes=array("article","book","booklet","confernce","inbook","incollection","inproceedings","manual","masterthesis","misc","phdthesis","proceedings","techreport","unpublished"),this.authorstring="VON LAST, JR, FIRST"}BibTex.prototype={setOption:function(a,b){return ret=!0,array_key_exists(a,this._options)?this._options[a]=b:ret=this.raiseError("Unknown option "+a),ret},parse:function(a){a&&(this.content=a),this.warnings=[],this.data=[];for(var b=!0,c=0,d=!1,e="",f="",g="",h=0;h<strlen(this.content);h++){if(e=substr(this.content,h,1),0!=c&&"@"==e&&(this._checkAt(g)||(this._generateWarning("WARNING_MISSING_END_BRACE","",g),e="}",h--)),0==c&&"@"==e)d=!0;else if(d&&"{"==e&&"\\"!=f)c++;else if(d&&"}"==e&&"\\"!=f&&(c--,0>c&&(b=!1),0==c)){d=!1;var i=this._parseEntry(g);i&&(this.data[this.data.length]=i),g=""}d&&(g+=e),f=e}if(1==c&&(i=this._parseEntry(g),i?(this.data[this.data.length]=i,g="",c=0):b=!1),0!=c&&(b=!1),this._options.validate){cites=array();for(var h=0;h<this.data.length;h++)cites[cites.length]=this.data[h].cite;if(unique=array_unique(cites),sizeof(cites)!=sizeof(unique)){notuniques=array();for(var h=0;h<sizeof(cites);h++)""==unique[h]&&(notuniques[notuniques.length]=cites[h]);this._generateWarning("WARNING_MULTIPLE_ENTRIES",implode(",",notuniques))}}return b?(this.content="",!0):this.raiseError("Unbalanced parenthesis")},_parseEntry:function(a){var b="";this._options.validate&&(b=a);var c={};if("@string"==strtolower(substr(a,0,7)))this._options.validate&&this._generateWarning("STRING_ENTRY_NOT_YET_SUPPORTED","",a+"}");else if("@preamble"==strtolower(substr(a,0,9)))this._options.validate&&this._generateWarning("PREAMBLE_ENTRY_NOT_YET_SUPPORTED","",a+"}");else{for(;strrpos(a,"=")!==!1;){for(position=strrpos(a,"="),proceed=!0,"\\"==substr(a,position-1,1)&&(proceed=!1),proceed&&(proceed=this._checkEqualSign(a,position));!proceed;)substring=substr(a,0,position),position=strrpos(substring,"="),proceed=!0,"\\"==substr(a,position-1,1)&&(proceed=!1),proceed&&(proceed=this._checkEqualSign(a,position));value=trim(substr(a,position+1)),a=substr(a,0,position),","==substr(value,strlen(value)-1,1)&&(value=substr(value,0,-1)),this._options.validate&&this._validateValue(value,b),this._options.stripDelimiter&&(value=this._stripDelimiter(value)),this._options.unwrap&&(value=this._unwrap(value)),this._options.removeCurlyBraces&&(value=this._removeCurlyBraces(value)),position=strrpos(a,","),field=strtolower(trim(substr(a,position+1))),c[field]=value,a=substr(a,0,position)}var d=split("{",a);c.cite=trim(d[1]),c.entryType=strtolower(trim(d[0])),"@"==c.entryType.substring(0,1)&&(c.entryType=substr(c.entryType,1)),this._options.validate&&(this._checkAllowedEntryType(c.entryType)||this._generateWarning("WARNING_NOT_ALLOWED_ENTRY_TYPE",c.entryType,a+"}")),in_array("author",array_keys(c))&&this._options.extractAuthors&&(c.author=this._extractAuthors(c.author))}return c},_checkEqualSign:function(a,b){for(var c=!0,d=strlen(a),e=0,f=d-1;f>=b;f--)precedingchar=substr(a,f-1,1),charv=substr(a,f,1),"{"==charv&&"\\"!=precedingchar&&e++,"}"==charv&&"\\"!=precedingchar&&e--;if(0!=e&&(c=!1),c&&(entrycopy=trim(a),lastchar=substr(entrycopy,strlen(entrycopy)-1,1),","==lastchar&&(lastchar=substr(entrycopy,strlen(entrycopy)-2,1)),'"'==lastchar)){c=!1,found=0;for(var f=d;f>=b;f--)if(precedingchar=substr(a,f-1,1),charv=substr(a,f,1),'"'==charv&&"\\"!=precedingchar&&found++,2==found){c=!0;break}}return c},_checkAllowedEntryType:function(a){return in_array(a,this.allowedEntryTypes)},_checkAt:function(a){var b=!1,c=array_keys(this._delimiters),d=array_values(this._delimiters);if(strrpos(a,"=")!==!1){for(position=strrpos(a,"="),proceed=!0,"\\"==substr(a,position-1,1)&&(proceed=!1);!proceed;)substring=substr(a,0,position),position=strrpos(substring,"="),proceed=!0,"\\"==substr(a,position-1,1)&&(proceed=!1);value=trim(substr(a,position+1)),open=0,charv="",lastchar="";for(var e=0;e<strlen(value);e++)charv=substr(this.content,e,1),in_array(charv,c)&&"\\"!=lastchar?open++:in_array(charv,d)&&"\\"!=lastchar&&open--,lastchar=charv;open>0&&(b=!0)}return b},_stripDelimiter:function(a){var b=array_keys(this._delimiters);strlen(a);for(var d=substr(a,0,1),e=substr(a,-1,1);in_array(d,b)&&e==this._delimiters[d];)a=substr(a,1,-1),d=substr(a,0,1),e=substr(a,-1,1);return a},_unwrap:function(a){return a=a.replace(/\s+/," "),trim(a)},_wordwrap:function(a){return""!=a&&is_string(a)&&(a=wordwrap(a,this._options.wordWrapWidth,this._options.wordWrapBreak,this._options.wordWrapCut)),a},_extractAuthors:function(a){a=this._unwrap(a);var b=array();b=split(" and ",a);for(var c=0;c<sizeof(b);c++){var d=trim(b[c]),e="",f="",g="",h="";if(strpos(d,",")===!1){var i=array();i=split(" |~",d);var j=sizeof(i);if(1==j)g=i[0];else if(2==j)e=i[0],g=i[1];else{for(var k=!1,l=!1,m=0;j-1>m;m++)if(l)g+=" "+i[m];else if(k)if(o=this._determineCase(i[m]),this.isError(o));else if(0==o||-1==o){islast=!0;for(var n=m+1;j-1>n;n++)futurecase=this._determineCase(i[n]),this.isError(o)||0==futurecase&&(islast=!1);islast?(l=!0,-1==o?g+=" "+i[m]:f+=" "+i[m]):f+=" "+i[m]}else f+=" "+i[m];else{var o=this._determineCase(i[m]);this.isError(o)||(0==o?(k=!0,f+=" "+i[m]):e+=" "+i[m])}g+=" "+i[j-1]}}else{var i=array();if(i=explode(",",d),vonlastarray=array(),vonlastarray=explode(" ",i[0]),j=sizeof(vonlastarray),1==j)g=vonlastarray[0];else{l=!1;for(var m=0;j-1>m;m++)if(l)g+=" "+vonlastarray[m];else if(0!=this._determineCase(vonlastarray[m])){islast=!0;for(var n=m+1;j-1>n;n++)this._determineCase(vonlastarray[n]),o=this._determineCase(vonlastarray[n]),this.isError(o)||0==o&&(islast=!1);islast?(l=!0,g+=" "+vonlastarray[m]):f+=" "+vonlastarray[m]}else f+=" "+vonlastarray[m];g+=" "+vonlastarray[j-1]}3==sizeof(i)&&(h=i[1]),e=i[sizeof(i)-1]}b[c]={first:trim(e),von:trim(f),last:trim(g),jr:trim(h)}}return b},_determineCase:function(a){var b=-1,c=trim(a);if(is_string(a)&&strlen(c)>0)for(var d=0,e=!1,f=0;!e&&d<=strlen(a);){var g=substr(c,d,1),h=ord(g);123==h&&f++,125==h&&f--,h>=65&&90>=h&&0==f?(b=1,e=!0):h>=97&&122>=h&&0==f?(b=0,e=!0):d++}else b=this.raiseError("Could not determine case on word: "+a);return b},isError:function(a){return"Object"==typeof a&&1==a.isError},_validateValue:function(a,b){a.match(/^{.*@.*}/)&&this._generateWarning("WARNING_AT_IN_BRACES",a,b),a.match(/^\".*\\".*\"/)&&this._generateWarning("WARNING_ESCAPED_DOUBLE_QUOTE_INSIDE_DOUBLE_QUOTES",a,b);for(var c=0,d="",e="",f=0;f<strlen(a);f++)e=substr(a,f,1),"{"==e&&"\\"!=d&&c++,"}"==e&&"\\"!=d&&c--,d=e;0!=c&&this._generateWarning("WARNING_UNBALANCED_AMOUNT_OF_BRACES",a,b)},_removeCurlyBraces:function(a){for(var b=array_keys(this._delimiters),c=substr(a,0,1),d=substr(a,-1,1),e="",f="";in_array(c,b)&&d==this._delimiters[c];)e+=c,f+=d,a=substr(a,1,-1),c=substr(a,0,1),d=substr(a,-1,1);var h="12";return a=a.replace(/([^\\\\])\{(.*?[^\\\\])\}/,h),a=e+a+f},_generateWarning:function(a,b,c){"undefined"==typeof c&&(c=""),warning.warning=a,warning.entry=b,warning.wholeentry=c,this.warnings[this.warnings.length]=warning},clearWarnings:function(){this.warnings=array()},hasWarning:function(){return sizeof(this.warnings)>0?!0:!1},amount:function(){return sizeof(this.data)},_formatAuthor:function(a){return a.von=array_key_exists("von",a)?trim(a.von):"",a.last=array_key_exists("last",a)?trim(a.last):"",a.jr=array_key_exists("jr",a)?trim(a.jr):"",a.first=array_key_exists("first",a)?trim(a.first):"",ret=this.authorstring,ret=str_replace("VON",a.von,ret),ret=str_replace("LAST",a.last,ret),ret=str_replace("JR",a.jr,ret),ret=str_replace("FIRST",a.first,ret),trim(ret)},bibTex:function(){for(var a="",b=0;b<this.data.length;b++){var c=this.data[b];a+="@"+strtolower(c.entryType)+" { "+c.cite+",\n";for(key in c){var d=c[key];this._options.wordWrapWidth>0&&(d=this._wordWrap(d)),in_array(key,array("cite","entryType","author"))||(a+="	"+key+" = {"+d+"},\n")}if(array_key_exists("author",c))if(this._options.extractAuthors){tmparray=array();for(j in c.author){var e=c.author[j];tmparray[tmparray.length]=this._formatAuthor(e)}author=join(" and ",tmparray)}else author=c.author;else author="";a+="	author = {"+author+"}\n",a+="}\n\n"}return a},addEntry:function(a){this.data[this.data.length]=a},getStatistic:function(){for(var a=array(),b=0;b<this.data.length;b++){var c=this.data[b];array_key_exists(c.entryType,a)?a[c.entryType]++:a[c.entryType]=1}return a},rtf:function(){for(var a="{\\rtf\n",b=0;b<this.data.length;b++){var c=this.data[b];if(line=this.rtfstring,title="",journal="",year="",authors="",array_key_exists("title",c)&&(title=this._unwrap(c.title)),array_key_exists("journal",c)&&(journal=this._unwrap(c.journal)),array_key_exists("year",c)&&(year=this._unwrap(c.year)),array_key_exists("author",c))if(this._options.extractAuthors){tmparray=array();for(var d in c.author){var e=c.author[d];tmparray[tmparray.length]=this._formatAuthor(e)}authors=join(", ",tmparray)}else authors=c.author;""!=title||""!=journal||""!=year||""!=authors?(line=str_replace("TITLE",title,line),line=str_replace("JOURNAL",journal,line),line=str_replace("YEAR",year,line),line=str_replace("AUTHORS",authors,line),line+="\n\\par\n",a+=line):this._generateWarning("WARNING_LINE_WAS_NOT_CONVERTED","",print_r(c,1))}return a+="}"},html:function(a,b){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=this.data.length);for(var c="<p>\n",d=a;b>d;d++){var e=this.data[d],f=this.htmlstring,g="",h="",i="",k="";if(array_key_exists("title",e)&&(g=this._unwrap(e.title)),array_key_exists("journal",e)&&(h=this._unwrap(e.journal)),array_key_exists("year",e)&&(i=this._unwrap(e.year)),array_key_exists("author",e))if(this._options.extractAuthors){tmparray=array();for(j in e.author){var l=e.author[j];tmparray[tmparray.length]=this._formatAuthor(l)}k=join(", ",tmparray)}else k=e.author;""!=g||""!=h||""!=i||""!=k?(f=str_replace("TITLE",g,f),f=str_replace("JOURNAL",h,f),f=str_replace("YEAR",i,f),f=str_replace("AUTHORS",k,f),f+="\n",c+=f):this._generateWarning("WARNING_LINE_WAS_NOT_CONVERTED","",print_r(e,1))}return c+="</p>\n"}};